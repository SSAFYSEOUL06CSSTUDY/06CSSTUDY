# AOP

## AOP란?

AOP는 Aspect Oriented Programming의 약자로 관점 지향 프로그래밍이라고 불림. 
관점 지향은 쉽게 말해 어떤 로직을 기준으로 핵심적인 관점, 부가적인 관점으로 나누어서 보고 그 관점을 기준으로 각각 모듈화하겠다는 것. 
여기서 모듈화란 어떤 공통된 로직이나 기능을 하나의 단위로 묶는 것. 

예로들어 핵심적인 관점은 결국 우리가 적용하고자 하는 핵심 비즈니스 로직이 됨. 
또한 부가적인 관점은 핵심 로직을 실행하기 위해서 행해지는 데이터베이스 연결, 로깅, 파일 입출력 등을 예로 들 수 있음.



## OOP의 한계

객체지향 프로그래밍은 어플리케이션을 설계할 때 책임과 관심사에 따라 클래스를 분리함.
클래스가 단일 책임을 가지도록 분리함으로써 각 모듈의 응집도는 높아지고 결합도는 높아짐.
클래스를 변경하는 이유는 오직 한가지이며, 어플리케이션의 한 부분에서 변경이 발생했을 때, 그 파급효과가 시스템의 전체로 퍼져나가는 정도가 낮아짐.
전통적인 객체지향 설계 방식을 충실히 따르더라도, 여러 클래스에 로깅이나 보안 및 트랜잭션 등 공통된 기능들이 흩어져 각자 존재함 **(관심사)**.
어플리케이션의 핵심 비즈니스 로직 코드로부터 관심사를 분리해야함..
-> 이를 보완하고자 쓰이는 것이 관점지향 프로그래밍



### AOP 목적

<img src="https://github.com/myeon0109/06CSSTUDY/blob/144ba8032e6f3805e7dfc87ce3f9a89e562deb6d/image/image.png">

AOP에서 각 관점을 기준으로 로직을 모듈화한다는 것은 코드들을 부분적으로 나누어서 모듈화하겠다는 의미. 
이때, 소스 코드상에서 다른 부분에 계속 반복해서 쓰는 코드들을 발견할 수 있는 데 이것을 흩어진 관심사 (Cross-cutting Concerns/횡단 관심사)라 부름. (종류는 로깅, 보안, 트랜젝션이 있음.)

<img src="https://github.com/myeon0109/06CSSTUDY/blob/144ba8032e6f3805e7dfc87ce3f9a89e562deb6d/image/%EB%8B%A4%EC%9A%B4%EB%A1%9C%EB%93%9C.png">

위와 같이 흩어진 관심사를 Aspect로 모듈화하고 핵심적인 비즈니스 로직에서 분리하여 재사용 및 코드의 간결성을 높이고 변경에 유연함과 무한한 확장이 가능하도록 하는 것이 AOP의 취지.



### 다양한 AOP 적용 방식

#### 1. 컴파일 시점 적용

  컴파일 시점 적용 방식은 AspectJ 컴파일러가 일반 .java 파일을 컴파일할 때 부가기능을 넣어서 .class 파일로 컴파일해주는 것을 의미. 
  이 동작을 에스팩트와 실제 코드를 연결하는 위빙(weaving)이라고 부름.
  
#### 2. 클래스 로딩 시점 적용

  JVM내 클래스로더에 .class 파일을 올리는 시점에 바이트 코드를 조작해 부가기능 로직을 추가하는 방식.

#### 3. 런타임 시점 적용

  컴파일, 클래스 로딩, main() 메서드의 실행 이후에 자바가 제공하는 범위내에 부가 기능을 적용하는 방식. 
  이미 런타임 중이라 코드를 조작하기 어려워 스프링, 컨테이너, DI, 빈 등 여러 개념과 기능을 총동원하여 프록시를 통해 부가 기능을 적용하는 방식.

  프록시는 메서드 실행 시점에서만 다음 타겟을 호출할 수 있기 때문에, 런타임 시점에 부가기능을 적용하는 방식은 메서드의 실행 지점으로 제한됨.

## Spring AOP

Spring AOP는 런타임 시점에 적용하는 방식을 사용. 
이유는 컴파일 시점과 클래스 로딩 시점에 적용하려면 별도의 컴파일러와 클래스로더 조작기를 써야 하는데, 
이것을 정하고 사용 및 유지하는 과정이 매우 어렵고 복잡하기 때문.

### AOP 용어 및 개념

<img src="https://github.com/myeon0109/06CSSTUDY/blob/144ba8032e6f3805e7dfc87ce3f9a89e562deb6d/image/image(1).png">

 - Aspect
   - 공통 기능
   - 어드바이스 + 포인트컷을 모듈화한 애플리케이션의 횡단 기능
 - Join Point
   - 애플리케이션 실행 흐름에서의 특정 포인트 (ex. 클래스 초기화, 메서드 호출, 예외 발생 등)
   - 한 마디로 AOP를 적용할 수 있는 모든 지점 (스프링에서는 메서드 실행 지점으로 제한)
 - Advice
   - 조인포인트에서 실행되는 코드 즉 부가기능 그 자체
   - 에스팩트를 언제 핵심 코드에 적용할지 정의
  
|Type|설명|
|------|---|
|Before|조인포인트 실행 이전에 실행, 일반적으로 리턴타입 void|
|After <br> Returning|조인포인트 완료후 실행(ex. 메서드가 예외없이 실행될 때)|
|After <br> Throwing|메서드가 예외를 던지는 경우 실행|
|After <br> (finally)|조인포인트의 동작과 관계없이 실행|
|Around|메서드 호출 전후에 수행(조인포인트 실행 여부 선택, 반환 값 변환, 예외 변환, try~catch~finally 구문 처리 가능 등),<br> 가장 강력한 어드바이스이다.|

 - Pointcut
   - 조인포인트 중 어드바이스가 적용될 지점을 선별하는 기능
   - 주로 AspectJ 표현식으로 지정
 - Target
   - 핵심 기능을 담은 모듈 (=부가 기능 부여 대상)
   - 어드바이스를 받는 객체이고, 포인트컷으로 결정됨
 - Advisor
   - 스프링 AOP에서만 쓰는 용어로, 하나의 어드바이스와 하나의 포인트컷으로 구성된 에스팩트를 특별하게 지칭하는 말.

  <br>  <br>  <br>  <br>
  
[의존성 추가 참고 링크] (https://engkimbs.tistory.com/entry/%EC%8A%A4%ED%94%84%EB%A7%81AOP)
